# Backend Training Java

This project is related to the
[Scott Logic backend training](https://docs.google.com/a/scottlogic.co.uk/document/d/1HUDpO1fpfSFmYyDpPLJPcUJg4g8tYZeZLN7dN7KyDLA/edit?usp=sharing).

It contains a basic Order Matcher which can be communicated with over REST, Websocket, gRPC, and Solace PubSub+.

You can place an order which requires a price, quantity and whether you're selling or buying.

If it matches with another existing order, a trade is generated, and returned. If listening on Websocket or Solace then all trades are broadcast.

## Running

To run the matcher, execute the following from the `service-skeleton` directory:

``` bash
$ gradle bootRun
```

The main application for REST/Websocket client is listening on socket `8082`. E.g. when running locally, send requests to [http://localhost:8082](http://localhost:8082).

## Communication

This matcher has controllers for REST, Websocket, gRPC, and Solace PubSub+. These controllers can be found [here](service-skeleton/src/main/java/com/scottlogic/training/controllers).

There are example clients for each, and these example clients are found in the [resources](service-skeleton/src/main/resources) directory.

With the exception of the Solace client, all other clients must first have the server running (see above).

### REST

Orders can be placed/listed over a REST API:

```
GET /orders    :   Get a list of all BUY and SELL orders

POST /orders   :   Place a new order
```

When placing an order at `POST /orders`, the orders must be in the following JSON format:
```json
{
    "account": "test", // can be any string
    "price": 0.50,
    "quantity": 6,
    "action": "BUY" // options are BUY/SELL
}
```

There is also the option to use a Reactor endpoint, which have the same requirements and have the following APIs:

```
GET /reactor/orders

POST /reactor/orders
```

### Websocket

An example websocket client is available [here](service-skeleton/src/main/resources/static/index.html).

To place an order, send a message over websocket to `/app/placeOrder`, with the JSON format specified in the REST section.

All trades generated by the Matcher are emitted over `/topic/trades`.

### gRPC

An example gRPC communication script is available [here](service-skeleton/src/main/resources/grpc/placeOrders.js).

This script simply lists the current orders, places a random price/quantity order, and then prints the trades which were returned.

To run the script:

```bash
$ cd service-skeleton/src/main/resources/grpc
$ npm install
$ node placeOrders.js
```

### Solace PubSub+

An example Solace PubSub+ client is available [here](service-skeleton/src/main/resources/solace/index.html).

The Solace PubSub+ instance is running on AWS, and the console is available [here](https://mrw739c2f4ioq.messaging.solace.cloud:943/#/msg-vpns/bWF0Y2hlcnRlc3Q=/properties/summary?token=YWJj.eyJhY2Nlc3NfdG9rZW4iOiAibWF0Y2hlcnRlc3QtYWRtaW46NHU0Nm5oNjhuaXJyNXFjamlhNGkxMTkycHMifQ%3D%3D.eHl6&title=matcherTest&subtitle=matchertest). (NOTE: May need credentials to view)

#### Topics

There are two defined Topics:
```
matcher/placeOrder  :   Send an order in JSON format to this topic to place an order
matcher/trade       :   All trades generated are emitted to this topic
```

There is also one wildcard topic which the matcher is listening for:
```
user/*/placeOrder   :   Where * is the username to place the order under
```
This places an order with the username included in the topic. This is just a simple example of using wildcards to pass information in the topic name itself.

#### Queues

There is a queue which is defined for the `/matcher/placeOrder` topic. This allows orders to be placed even when the matcher is not running. Once the matcher starts up it will read all orders from the queue in the order they were placed.

## Docker

There is also a Dockerfile image for the Matcher backend.

### Pulling the image

The image has been built and can be pulled with the following command:

``` bash
$ docker pull jonnyspruce/matcher
```

Once pulled, you can run it with:

```bash
$ docker run -p 8082:8082 -p 9090:9090 jonnyspruce/matcher
```

### Building the image

If any changes have been made to code you can then rebuild the image and run it with the following:

```bash
$ docker build -t <image name>
$ docker run  -p 8082:8082 -p 9090:9090 <image name>
```

### Deploying to AWS

[This guide](https://aws.amazon.com/getting-started/hands-on/deploy-docker-containers/) provides a good overview of how to deploy a docker container on an AWS EC2 instance. **Note:** ~2GB of memory is needed to run the application successfully.